# Внешняя компонента для обмена 1С с Kafka

Версия 0.2b

**!!! Проект в разработке !!!**

[Сборка внешней компоненты](./doc/build.md)

Структура помпоненты

![Структура компоненты](./doc/res/structure.png)

## Использование

### Пример конфигурации 1С

В каталоге `/cf` размещен пример конфигурации для демонстрации возможностей внешней компоненты.

### Работа с компонентой

Тут приведу простые примеры работы с компонентой в различных ситуациях.

#### Подключение

```bsl
ПодключитьВнешнююКомпоненту("ОбщийМакет.RdKafka1C", "Kafka", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.Изолированно);
```

#### Отправка данных в Кафку

```bsl
Компонента = Новый ("AddIn.Kafka.RdKafka1C");
Результат = Компонента.ИнициализироватьПродюсера(Брокер, Топик);
Если НЕ Результат Тогда
    ВызватьИсключение Компонента.ОписаниеОшибки;
КонецЕсли;

Результат = Компонента.Отправить("Тестовое сообщение");
Если НЕ Результат Тогда
    ВызватьИсключение Компонента.ОписаниеОшибки;
КонецЕсли;

Результат = Компонента.ОстановитьПродюсера();
Если НЕ Результат Тогда
    ВызватьИсключение Компонента.ОписаниеОшибки;
КонецЕсли;
```

#### Чтение данных из Кафки

```bsl
Компонента = Новый ("AddIn.Kafka.RdKafka1C");
Результат = Компонента.ИнициализироватьКонсюмера(Брокер, Топик, ГруппаКонсюмера);
Если НЕ Результат Тогда
    ВызватьИсключение Компонента.ОписаниеОшибки;
КонецЕсли;

Если Компонента.Прочитать() Тогда
    СообщитьПользователю(Компонента.ДанныеСообщения());
    СообщитьПользователю(Компонента.МетаданныеСообщения());
КонецЕсли;

Результат = Компонента.ОстановитьКонсюмера();
Если НЕ Результат Тогда
    ВызватьИсключение Компонента.ОписаниеОшибки;
КонецЕсли;
```

#### Логиирование

В компоненте максимально подробно реализовано логирование событий в файл. Файл создается автоматически в указанном каталоге.
Простой пример включения логирования:

```bsl
Если Компонента.НачатьЛогирование(Объект.КаталогЛогов) Тогда
    ЛогФайл = Компонента.ЛогФайл;
КонецЕсли;
```

Все логи собираются из двух источников данных:

1. Логи класса RdKafka1C и вспомогательных классов.
2. Логи библиотеки RdKafka. Добавлен префикс `[KAFKA]`

По умолчанию уровень логов максимально `debug`, его можно изменить на:

- `none` - логи не записываются
- `error` - логирование ошибок
- `warn` - добавляется логирование предупреждений
- `info` - добавляется логирование общих событий RdKafka1C
- `debug` - добавляется максимально подробное логирование RdKafka1C и библиотеки RdKafka

```bsl
Компонента.УровеньЛогирования = "info";
```

## Ссылки

- [librdkafka](https://github.com/confluentinc/librdkafka)
- [vcpkg](https://github.com/microsoft/vcpkg)
- [googletest](https://github.com/google/googletest)
